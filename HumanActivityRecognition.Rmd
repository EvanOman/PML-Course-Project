---
title: "Human Activity Recognition"
author: "Evan Oman"
date: "October 23, 2015"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, warning=FALSE, cache=TRUE, message=FALSE}
library(caret)
library(rpart)
library(rpart.plot)
library(randomForest)
library(reshape2)
library(ggplot2)
```

You can also embed plots, for example:

```{r, warning=FALSE, cache=TRUE, message=FALSE}
allData <- read.csv("./pml-training.csv", na.strings=c("","NA"))
subTest <- read.csv("./pml-testing.csv")
```

```{r,warning=FALSE, cache=TRUE, message=FALSE}
allData.cleaned <- subset(allData, select = -c(user_name,raw_timestamp_part_1,raw_timestamp_part_2,cvtd_timestamp,num_window,new_window,X))
```


```{r,warning=FALSE, cache=TRUE, message=FALSE}
for (i in names(allData[,1:(ncol(allData)-1)]))
{
  allData.cleaned[[i]] <- as.numeric(allData[[i]])
}
```

```{r, warning=FALSE, cache=TRUE, message=FALSE}
# Gets the number of rows
nObs <- nrow(allData.cleaned)

# We will now remove all predictors for which there are more than 25% NA's
allData.cleaned <- allData.cleaned[,colSums(is.na(allData))/nObs < 0.25]
```

```{r, warning=FALSE, cache=TRUE, message=FALSE}
inTrain <- createDataPartition(y=allData.cleaned$classe,p=.7,list=FALSE)
training <- allData.cleaned[inTrain,]
testing <- allData.cleaned[-inTrain,]
```

```{r, warning=FALSE, cache=TRUE, message=FALSE}
myControl <- trainControl(method="cv", 5)
modFit <- train(classe ~ ., method="rf", data=training, verbose=FALSE, trControl = myControl, ntree=250)
```

```{r, warning=FALSE, cache=TRUE, message=FALSE}
# Make predictions
preds <- predict(modFit, testing)

```

```{r, warning=FALSE, cache=TRUE, message=FALSE}

# Print accuracy
confusionMatrix(preds,testing$classe)
```

```{r, warning=FALSE, cache=TRUE, message=FALSE}
# First we clean the submission test set
myPredictors <- names(allData.cleaned)
myPredictors <- myPredictors[myPredictors!= "classe"]
subTest <- subTest[,myPredictors]
# Make predictions on submission test set
predsSub <- predict(modFit, subTest)
```

```{r, warning=FALSE, cache=TRUE, message=FALSE}
# Make predictions on 
confusionMatrix(predsSub,testing$classe)
```

```{r, warning=FALSE, cache=TRUE, message=FALSE,fig.height = 30,fig.width=10}
d <- melt(data.frame(scale(allData[,1:(ncol(allData)-1)])))
ggplot(d,aes(x = value)) + 
  facet_wrap(~variable,scales = "free_x", ncol = 4) + 
  geom_histogram() +
  ggtitle("Scaled Histograms of All Predictors")
```